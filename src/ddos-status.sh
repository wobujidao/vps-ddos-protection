#!/bin/bash
clear
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘          DDoS Protection Status Monitor              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ›¡ï¸  Service: $(systemctl is-active vps-protection)"
echo "â±ï¸  Uptime: $(ps -o etime= -p $(cat /var/run/vps-protection-monitor.pid 2>/dev/null) 2>/dev/null || echo 'N/A')"
echo ""
echo "ğŸ“Š Blocked Packets:"
WG_BLOCKED=$(sudo iptables -L INPUT -n -v -x 2>/dev/null | grep "DROP.*51820" | head -1 | awk '{print $1}')
TS_BLOCKED=$(sudo iptables -L INPUT -n -v -x 2>/dev/null | grep "DROP.*9987" | head -1 | awk '{print $1}')
printf "   WireGuard: %'d packets\n" $WG_BLOCKED 2>/dev/null || echo "   WireGuard: $WG_BLOCKED packets"
printf "   TeamSpeak: %'d packets\n" $TS_BLOCKED 2>/dev/null || echo "   TeamSpeak: $TS_BLOCKED packets"
echo ""
echo "ğŸš« Blacklisted:"
echo "   IPv4: $(sudo ipset list blacklist4 2>/dev/null | grep -c timeout) IPs"
echo "   IPv6: $(sudo ipset list blacklist6 2>/dev/null | grep -c timeout) IPs"
echo ""
echo "ğŸ‘¥ Active Connections:"
echo "   WireGuard: $(docker exec wg-easy wg show 2>/dev/null | grep "latest handshake" | wc -l) clients"
echo "   TeamSpeak: $(ps aux | grep ts3server | grep -v grep | wc -l) server running"
echo ""
echo "âš™ï¸  Protection Settings:"
source /etc/vps-protection/config 2>/dev/null
echo "   WireGuard: $WG_RATE_LIMIT packets/sec"
echo "   TeamSpeak: $TS_RATE_LIMIT packets/sec"
echo "   Alert threshold: $ALERT_THRESHOLD packets"
echo "   Block duration: $((BLOCK_TIME/60)) minutes"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
